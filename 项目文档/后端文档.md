# 后端技术文档

后端系统采用 Go 语言编写，遵循 RESTful 规范，核心侧重于高性能的数据吞吐及与 MySQL 存储过程的深度联动。

## 🏗️ 架构概览

- **语言**: Go (Golang)
- **Web 框架**: [Gin](https://gin-gonic.com/)
- **ORM**: [GORM](https://gorm.io/)
- **安全性**: Bcrypt 密码哈希、自定义 CORS 跨域控制。

## 🛠️ 核心模块解析

### 1. 接口分发 (`cmd/main.go`)
集中定义 API 路由组。通过 Gin 的路由嵌套实现模块化：
- `/api/auth`: 登录与身份验证。
- `/api/medicines`: 药品资源管理。
- `/api/sales`: 销售订单核心流程。
- `/api/analysis`: 数据挖掘与高级分析接口。

### 2. 业务处理器 (`internal/api/handlers.go`)
- **逻辑下沉**：后端 Handler 并不直接编写复杂的 SQL 统计逻辑，而是通过 `database.DB.Raw("CALL sp_...")` 调用数据库存储过程。
- **分页辅助**：统一的 `getPaginationParams` 助手函数，确保全站搜索接口的入参一致。
- **事务管理**：在涉及库存变更（入库/销售）时，使用 `tx := database.DB.Begin()` 开启手动事务，确保多步数据库操作的原子性。

### 3. 数据模型 (`internal/model/types.go`)
- 使用 GORM 的结构体标签 (`json`, `gorm`, `form`) 定义数据库表映射。
- 采用 **BigInt** 作为主键，以支持大规模数据量的扩展。

## 💾 数据库联动

后端与数据库之间不仅是 CRUD 关系，还包括：
- **存储过程触发**：调用 `sp_top_selling_medicines` 等完成动态排序的复杂聚合。
- **错误捕获**：捕获并解析数据库触发器抛出的 `SIGNAL SQLSTATE`（如“库存不足”），并将其转化为友好的 HTTP 400 响应。

## 🚀 扩展性设计
- **配置隔离**：通过 `internal/config` 进行环境变量映射。
- **接口兼容**：返回结构化 JSON 响应，包含 `data` 和 `meta` (分页信息)。
